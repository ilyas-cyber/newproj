<!DOCTYPE html>
<html lang="en">
   <head>
    <style>
      /* Global styles */
      * {
        margin: -8px;
        padding: 10px;
        box-sizing: border-box;
      }
      body {
        background-image: url('/solar-system.jpg');
        background-size: cover;
        background-position: center center;
      }

      

      main {
        padding: 1rem;
      }

      h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      h3 {
        font-size: 1.25rem;
        margin-top: 2rem;
      }

      #myMap {
        width: 100%;
        height: 50vh;
        margin-bottom: 1rem;
      }

      #legend {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
      }

      #legend li {
        margin-right: 2rem;
        display: flex;
        align-items: center;
      }

      .color-1 {
        width: 20px;
        height: 20px;
        background-color: #FFD700;
        margin-right: 1rem;
      }

      .color-2 {
        width: 20px;
        height: 20px;
        background-color: #FFA500;
        margin-right: 1rem;
      }

      .color-3 {
        width: 20px;
        height: 20px;
        background-color: #FF6347;
        margin-right: 1rem;
      }

      #next-button {
        /* background-color: #3B3B3B;
        color: #fff;
        padding: 10px;
        border: none;
        width: 220px;
        margin-right: 150px;
        margin-bottom: -140;
        cursor: pointer; */
        border: 0px;
        border-radius: 9999px;
        min-width: 160px;
        min-height: 48px;
        padding: 12px 24px;
        cursor: pointer;
        font-family: Poppins, "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        -webkit-box-align: center;
        align-items: center;
        text-align: center;
        transition: padding 0.1s ease 0s, background-image 0.1s ease 0s, background 0.1s ease 0s, background-color 0.1s ease 0s, color 0.1s ease 0s;
        letter-spacing: 0.0125em;
        position: relative;
        -webkit-font-smoothing: antialiased;
        color: rgb(255, 255, 255);
        background-color: rgb(30, 64, 180);
        background-image: linear-gradient(to right, rgb(49, 86, 196), rgb(30, 64, 180));
        -webkit-box-pack: center}
/* button active effect */
.btn:active {
background-color: #3e8e41;
box-shadow: none;
}

/* button disabled effect */
.btn.disabled {
background-color: #ccc;
cursor: not-allowed;
}

/* button primary style */
.btn-primary {
background-color: #007bff;
}

/* button danger style */
.btn-danger {
background-color: #dc3545;
}

/* button warning style */
.btn-warning {
background-color: #ffc107;
}

/* button success style */
.btn-success {
background-color: #28a745;
}

/* button info style */
.btn-info {
background-color: #17a2b8;
}

/* button rounded style */
.btn-rounded {
border-radius: 30px;
}

/* button outline style */
.btn-outline {
background-color: transparent;
border: 2px solid #007bff;
color: #007bff;
}

/* button outline primary style */
.btn-outline-primary {
border-color: #007bff;
color: #007bff;
}

/* button outline danger style */
.btn-outline-danger {
border-color: #dc3545;
color: #dc3545;
}

/* button outline warning style */
.btn-outline-warning {
border-color: #ffc107;
color: #ffc107;
}

/* button outline success style */
.btn-outline-success {
border-color: #28a745;
color: #28a745;
}

/* button outline info style */
.btn-outline-info {
border-color: #17a2b8;
color: #17a2b8;
}

/* button block style */
.btn-block {
display: block;
width: 100%;
}

/* button group style */
.btn-group {
display: inline-flex;
justify-content: center;
align-items: center;
}

/* button group vertical style */
.btn-group-vertical {
flex-direction: column;
}

/* button group horizontal style */
.btn-group-horizontal {
flex-direction: row;
}

/* button group size style */
.btn-group .btn {
margin: 0px;
border-radius: 0px;
}

/* button group size large style */
.btn-group-lg .btn {
padding: 12px 24px;
font-size: 20px;
}

/* button group size small style */
.btn-group-sm .btn {
padding: 6px 12px;
font-size: 12px;
}

/* button icon style */
.btn-icon {
display: inline-flex;
justify-content: center;
align-items: center;
}

/* button icon size style */
.btn-icon .icon {
margin-right: 8px;
}

/* button icon only style */
.btn-icon-only {
padding: 12px;
border-radius: 30px;
}

/* button icon primary style */
.btn-icon-primary {
background-color: #007bff;
color: #fff;
}

/* button icon danger style */
.btn-icon-danger {
background-color: #dc3545;
color: #fff;
}

/* button icon warning style */
.btn-icon-warning {
background-color: #ffc107;
color: #fff;
}

/* button icon success style */
.btn-icon-success {
background-color: #28a745;
color: #fff;
}

/* button icon info style */
.btn-icon-info {
background-color: #17a2b8;
color: #fff;
}

/* button disabled style */
.btn[disabled] {
cursor: not-allowed;
opacity: 0.5;
}

/* button active style */
.btn:active {
transform: translateY(1px);
}

/* button focus style */
.btn:focus {
outline: none;
box-shadow: none

}

  </style>
   </head>


<body>

  <header>
    
  </header>
  <div>
    <form id="address-form">
      <input type="text" id="location-input" placeholder="Search Your Location here...">
      <button type="submit">Search</button>
      <br><br><br>
      <button type="button" id="self-locate-button"> Locate Me</button>
    </form>
  </div>

  <h3>Drag And Fix your Roof</h3>

  <main>
    <script type='text/javascript'
      src='https://www.bing.com/api/maps/mapcontrol?key=AuK2Azrt3w9gxRMlMrgjzXZ0f2to9NbfewreFM1qp_nVcPKgcJZCWj_AC5gdRfX9'></script>
    <script type='text/javascript'>
      var map;
      function loadMapScenario() {
        map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
          mapTypeId: Microsoft.Maps.MapTypeId.aerial,
          zoom: 21
        });

        function displayMap(latitude, longitude) {
          // Create a new map object centered on the user's location
          const center = new Microsoft.Maps.Location(latitude, longitude);
          map.setView({ center: center });

          // Add a pushpin to the map at the user's location
          const pin = new Microsoft.Maps.Pushpin(center, { draggable: true });
          map.entities.push(pin);
          // const pin = new Microsoft.Maps.Pushpin(center, { draggable: true });
          pin.addEventListener('dragend', event => {
            console.log(`New pin location: ${pin.getLocation().latitude}, ${pin.getLocation().longitude}`);
          });
        }
      }
    </script>
    </head>


    <body onload='loadMapScenario();'>
      <div id='printoutPanel'></div>

      <div id='myMap'></div>

      <div id="legend">
        <h2>Legend</h2>
        <ul>
          <li><span class="color-1"></span> Solar Energy Potential Low</li>
          <li><span class="color-2"></span> Solar Energy Potential Medium</li>
          <li><span class="color-3"></span> Solar Energy Potential High</li>
        </ul>
        <ul><li>      <div><button id="next-button" >Next</button>
        </div></li></ul>
      </div>

  </main>

  <footer>
    <nav>
      <ul>
        <li><a href="#">Legal Information</a></li>
        <li><a href="#">Privacy Policy</a></li>
        <li><a href="#">Contact Us </a></li>


            <div id="system-design"></div>

            <script>

            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById("next-button").addEventListener("click", function() {
  fetch("/pvcalc")
    .then(response => {
      if (response.ok) {
        return response.text();
      }
      throw new Error("Network response was not ok");
    })
    .then(data => {
        // Redirect user to "/pvcalc" endpoint
        window.location.href = "/pvcalc";
      })

    .catch(error => {
      // handle error
      console.error("Error fetching data:", error);
    });
});
        
             function displayMap(latitude, longitude) {
                  // Create a new map object centered on the user's location
                  const center = new Microsoft.Maps.Location(latitude, longitude);
                  map.setView({ center: center, zoom: 21 });

                  // Add a pushpin to the map at the user's location
                  const pin = new Microsoft.Maps.Pushpin(center, { draggable: true });
                  map.entities.push(pin);
                  // const pin = new Microsoft.Maps.Pushpin(center, { draggable: true });
                  pin.addEventListener('dragend', event => {
                    console.log(`New pin location: ${pin.getLocation().latitude}, ${pin.getLocation().longitude}`);
                  });

                }

 window.onload = function() {
            // Get the form element and submit button
            const form = document.querySelector('#address-form');
            const submitButton = form.querySelector('button[type="submit"]');

            fetch('/map', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ location: searchTerm })
})
.then(response => {
     // Add an event listener for when the form is submitted
     const locationForm = document.querySelector('form');
                const locationInput = document.querySelector('#location-input');

                locationForm.addEventListener('submit', event => {
                  event.preventDefault();
                  const location = locationInput.value;
                  geocode(location)
                    .then(({ latitude, longitude }) => {
                      displayMap(latitude, longitude);
                    })
                    .catch(error => {
                      console.error(`Error geocoding location '${location}': ${error.message}`);
                    });
                });
  // Extract the location data from the response
 const location = data.location;
// Update the value of the location input field in the form
document.getElementById('location-input').value = location;
})
.catch(error => {
  // Handle any errors that occurred during the AJAX request
  console.error(error);
});
 }



            


                // Make an AJAX request to fetch data from the server
 
                
                // Define the geocoding API endpoint and API key
                const geocodeEndpoint = 'https://maps.googleapis.com/maps/api/geocode/json';
                const apiKey = 'AuK2Azrt3w9gxRMlMrgjzXZ0f2to9NbfewreFM1qp_nVcPKgcJZCWj_AC5gdRfX9';

                // Get the form element and submit button

               


                function geocode(location) {
                  const bingMapsKey = 'AuK2Azrt3w9gxRMlMrgjzXZ0f2to9NbfewreFM1qp_nVcPKgcJZCWj_AC5gdRfX9';
                  const geocodeUrl = `https://dev.virtualearth.net/REST/v1/Locations?q=${encodeURIComponent(location)}&key=${bingMapsKey}`;
                  return fetch(geocodeUrl)
                    .then(response => response.json())
                    .then(data => {
                      const resourceSets = data.resourceSets || [];
                      const resources = resourceSets[0].resources || [];
                      if (resources.length > 0) {
                        const point = resources[0].point || {};
                        return { latitude: point.coordinates[0], longitude: point.coordinates[1] };
                      } else {
                        throw new Error('Location not found');
                      }
                    });
                }


                function generateSystemDesign(latitude, longitude) {
                  
                  const systemDesign = {
                    roofAngle: 30,
                    shading: 'partial',
                    availableSpace: 50
                  };
                  return systemDesign;
                }

                function displaySystemDesign(systemDesign) {
                 
                  const systemDesignElement = document.querySelector('#system-design');
                  systemDesignElement.innerHTML = `
    <p>Roof angle: ${systemDesign.roofAngle}</p>
    <p>Shading: ${systemDesign.shading}</p>
    <p>Available space: ${systemDesign.availableSpace} sq. ft.</p>
    `;
                }
              });
              
</script>

</body>

</html>